<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.8;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 600px;
        }
        
        .sidebar {
            background: #34495e;
            color: white;
            padding: 30px;
        }
        
        .content {
            padding: 30px;
        }
        
        .auth-section {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #219a52;
        }
        
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .book-card {
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .book-card:hover {
            transform: translateY(-5px);
        }
        
        .book-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .book-author {
            color: #7f8c8d;
            font-style: italic;
            margin-bottom: 10px;
        }
        
        .book-pages {
            color: #3498db;
            font-weight: bold;
        }
        
        .progress-bar {
            background: #ecf0f1;
            border-radius: 10px;
            height: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            background: #27ae60;
            height: 100%;
            transition: width 0.3s;
        }
        
        .hidden {
            display: none;
        }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö Book Tracker</h1>
            <div class="subtitle">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ —á—Ç–µ–Ω–∏–∏</div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="section">
                    <h3>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
                    <div class="auth-section">
                        <div class="form-group">
                            <label for="username">–õ–æ–≥–∏–Ω:</label>
                            <input type="text" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                        </div>
                        <div class="form-group">
                            <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        </div>
                        <button onclick="login()">–í–æ–π—Ç–∏</button>
                        <button onclick="register()" style="margin-top: 10px; background: #95a5a6;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                    </div>
                    
                    <div id="token-section" class="hidden">
                        <div class="form-group">
                            <label for="token">–¢–æ–∫–µ–Ω:</label>
                            <input type="text" id="token" placeholder="JWT —Ç–æ–∫–µ–Ω" readonly>
                        </div>
                        <button onclick="copyToken()" class="btn-success">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω</button>
                    </div>
                </div>
                
                <div class="section">
                    <h3>üìñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                    <button onclick="loadBooks()" style="width: 100%; margin-bottom: 10px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–∏–≥–∏</button>
                    <button onclick="showAddBookForm()" style="width: 100%;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</button>
                </div>
            </div>
            
            <div class="content">
                <div id="message"></div>
                
                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–Ω–∏–≥–∏ -->
                <div id="add-book-form" class="hidden">
                    <div class="section">
                        <h3 class="section-title">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–∏–≥—É</h3>
                        <div class="form-group">
                            <label for="book-title">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                            <input type="text" id="book-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏">
                        </div>
                        <div class="form-group">
                            <label for="book-author">–ê–≤—Ç–æ—Ä:</label>
                            <input type="text" id="book-author" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞">
                        </div>
                        <div class="form-group">
                            <label for="book-description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                            <textarea id="book-description" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–Ω–∏–≥–∏" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="book-pages">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü:</label>
                            <input type="number" id="book-pages" placeholder="–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü">
                        </div>
                        <button onclick="addBook()" class="btn-success">üìö –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</button>
                        <button onclick="hideAddBookForm()" style="background: #95a5a6;">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ -->
                <div id="books-section">
                    <h3 class="section-title">–ú–æ–∏ –∫–Ω–∏–≥–∏</h3>
                    <div id="books-grid" class="books-grid">
                        <div class="book-card">
                            <div class="book-title">–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</div>
                            <div class="book-author">–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∞—à–∏ –∫–Ω–∏–≥–∏</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000';
        let currentToken = '';

        function showMessage(text, type = 'success') {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`;
            setTimeout(() => messageDiv.innerHTML = '', 5000);
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentToken = data.access_token;
                    document.getElementById('token').value = currentToken;
                    document.getElementById('token-section').classList.remove('hidden');
                    showMessage('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!');
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ localStorage
                    localStorage.setItem('bookTrackerToken', currentToken);
                    localStorage.setItem('bookTrackerUsername', username);
                    
                    loadBooks();
                } else {
                    showMessage(data.detail, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
            }
        }

         async function register() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const email = `${username}@example.com`;
    
    showMessage('–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º...');
    
    try {
        const response = await fetch(`${API_BASE}/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, email, password })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showMessage('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.', 'success');
            console.log('Registration success:', data);
        } else {
            showMessage(`–û—à–∏–±–∫–∞: ${data.detail}`, 'error');
            console.error('Registration error:', data);
        }
    } catch (error) {
        showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
        console.error('Connection error:', error);
    }
}

        async function loadBooks() {
            if (!currentToken) {
                showMessage('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/books`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                if (response.ok) {
                    const books = await response.json();
                    await displayBooks(books);
                } else {
                    showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥', 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
            }
        }

        async function displayBooks(books) {
            const booksGrid = document.getElementById('books-grid');
            
            if (books.length === 0) {
                booksGrid.innerHTML = '<div class="book-card"><div class="book-title">–ö–Ω–∏–≥ –ø–æ–∫–∞ –Ω–µ—Ç</div></div>';
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–∏–≥–∏
            const booksWithProgress = await Promise.all(
                books.map(async (book) => {
                    try {
                        const progressResponse = await fetch(`${API_BASE}/books/${book.id}/progress`, {
                            headers: { 'Authorization': `Bearer ${currentToken}` }
                        });
                        
                        if (progressResponse.ok) {
                            const progress = await progressResponse.json();
                            return { ...book, progress };
                        }
                    } catch (error) {
                        console.error('Error loading progress:', error);
                    }
                    return { ...book, progress: null };
                })
            );
            
            booksGrid.innerHTML = booksWithProgress.map(book => {
                const currentPage = book.progress ? book.progress.current_page : 0;
                const progressPercent = book.total_pages > 0 ? 
                    Math.round((currentPage / book.total_pages) * 100) : 0;
                
                return `
                <div class="book-card">
                    <div class="book-title">${book.title}</div>
                    <div class="book-author">${book.author}</div>
                    <div class="book-pages">üìñ ${currentPage} / ${book.total_pages} —Å—Ç—Ä–∞–Ω–∏—Ü</div>
                    <div style="margin: 10px 0;">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressPercent}%"></div>
                        </div>
                        <div style="text-align: center; font-size: 14px; color: #7f8c8d;">
                            ${progressPercent}% –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
                        </div>
                    </div>
                    <div>${book.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                    <div style="margin-top: 15px;">
                        <input type="number" id="progress-${book.id}" 
                               placeholder="–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞" 
                               value="${currentPage}"
                               style="width: 70%;">
                        <button onclick="updateProgress(${book.id})" 
                                style="width: 28%; margin-left: 2%;">üìå –û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        async function updateProgress(bookId) {
            const currentPage = document.getElementById(`progress-${bookId}`).value;
            
            if (!currentPage || currentPage < 0) {
                showMessage('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/books/${bookId}/progress`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({ current_page: parseInt(currentPage) })
                });
                
                if (response.ok) {
                    showMessage('–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω!');
                    loadBooks(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
                } else {
                    showMessage('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞', 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
            }
        }

        async function addBook() {
            if (!currentToken) {
                showMessage('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }
            
            const title = document.getElementById('book-title').value;
            const author = document.getElementById('book-author').value;
            const description = document.getElementById('book-description').value;
            const total_pages = parseInt(document.getElementById('book-pages').value);
            
            if (!title || !author || !total_pages) {
                showMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/books`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({ title, author, description, total_pages })
                });
                
                if (response.ok) {
                    showMessage('–ö–Ω–∏–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
                    hideAddBookForm();
                    loadBooks();
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('book-title').value = '';
                    document.getElementById('book-author').value = '';
                    document.getElementById('book-description').value = '';
                    document.getElementById('book-pages').value = '';
                } else {
                    const data = await response.json();
                    showMessage(data.detail, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
            }
        }

        function showAddBookForm() {
            if (!currentToken) {
                showMessage('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }
            document.getElementById('add-book-form').classList.remove('hidden');
        }

        function hideAddBookForm() {
            document.getElementById('add-book-form').classList.add('hidden');
        }

        function copyToken() {
            const tokenInput = document.getElementById('token');
            tokenInput.select();
            document.execCommand('copy');
            showMessage('–¢–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            const savedToken = localStorage.getItem('bookTrackerToken');
            const savedUsername = localStorage.getItem('bookTrackerUsername');
            
            if (savedToken && savedUsername) {
                currentToken = savedToken;
                document.getElementById('username').value = savedUsername;
                document.getElementById('token').value = currentToken;
                document.getElementById('token-section').classList.remove('hidden');
                showMessage(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${savedUsername}!`);
                loadBooks();
            }
        });
    </script>
</body>
</html>